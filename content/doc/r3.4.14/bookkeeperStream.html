
<!DOCTYPE html>
<html>
<head>
    <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>ZooKeeper: Because Coordinating Distributed Systems is a Zoo</title>
    <link type="text/css" href="skin/basic.css" rel="stylesheet">
    <link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
    <link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
    <link type="text/css" href="skin/profile.css" rel="stylesheet">
    <script src="skin/getBlank.js" language="javascript" type="text/javascript"></script>
    <script src="skin/getMenu.js" language="javascript" type="text/javascript"></script>
    <script src="skin/init.js" language="javascript" type="text/javascript"></script>
    <link rel="shortcut icon" href="images/favicon.ico">
</head>
<body onload="init();">
<div id="top">
    <div class="breadtrail">
        <a href="http://www.apache.org/">Apache</a> &gt; <a href="http://zookeeper.apache.org/">ZooKeeper</a>
    </div>
    <div class="header">
        <div class="grouplogo">
            <a href="http://hadoop.apache.org/"><img class="logoImage" alt="Hadoop" src="images/hadoop-logo.jpg" title="Apache Hadoop"></a>
        </div>
        <div class="projectlogo">
            <a href="http://zookeeper.apache.org/"><img class="logoImage" alt="ZooKeeper" src="images/zookeeper_small.gif" title="ZooKeeper: distributed coordination"></a>
        </div>
        <div class="searchbox">
            <form action="http://www.google.com/search" method="get">
                <input value="zookeeper.apache.org" name="sitesearch" type="hidden"><input onFocus="getBlank (this, 'Search the site with google');" size="25" name="q" id="query" type="text" value="Search the site with google">&nbsp;
                <input name="Search" value="Search" type="submit">
            </form>
        </div>
        <ul id="tabs">
            <li>
                <a class="unselected" href="http://zookeeper.apache.org/">Project</a>
            </li>
            <li>
                <a class="unselected" href="https://cwiki.apache.org/confluence/display/ZOOKEEPER/">Wiki</a>
            </li>
            <li class="current">
                <a class="selected" href="index.html">ZooKeeper 3.4 Documentation</a>
            </li>
        </ul>
    </div>
</div>
<div id="main">
    <div id="publishedStrip">
        <div id="level2tabs"></div>
        <script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
    </div>
    <div class="breadtrail">
        &nbsp;
    </div>
    <div id="menu">
        <div onclick="SwitchMenu('menu_1', 'skin/')" id="menu_1Title" class="menutitle">Overview</div>
        <div id="menu_1" class="menuitemgroup">
            <div class="menuitem">
                <a href="index.html">Welcome</a>
            </div>
            <div class="menuitem">
                <a href="zookeeperOver.html">Overview</a>
            </div>
            <div class="menuitem">
                <a href="zookeeperStarted.html">Getting Started</a>
            </div>
            <div class="menuitem">
                <a href="releasenotes.html">Release Notes</a>
            </div>
        </div>
        <div onclick="SwitchMenu('menu_2', 'skin/')" id="menu_2Title" class="menutitle">Developer</div>
        <div id="menu_2" class="menuitemgroup">
            <div class="menuitem">
                <a href="api/index.html">API Docs</a>
            </div>
            <div class="menuitem">
                <a href="zookeeperProgrammers.html">Programmer's Guide</a>
            </div>
            <div class="menuitem">
                <a href="javaExample.html">Java Example</a>
            </div>
            <div class="menuitem">
                <a href="zookeeperTutorial.html">Barrier and Queue Tutorial</a>
            </div>
            <div class="menuitem">
                <a href="recipes.html">Recipes</a>
            </div>
        </div>
        <div onclick="SwitchMenu('menu_3', 'skin/')" id="menu_3Title" class="menutitle">Bookkeeper</div>
        <div id="menu_3" class="menuitemgroup">
            <div class="menuitem">
                <a href="bookkeeperStarted.html">Getting started</a>
            </div>
            <div class="menuitem">
                <a href="bookkeeperOverview.html">Overview</a>
            </div>
            <div class="menuitem">
                <a href="bookkeeperConfig.html">Setup guide</a>
            </div>
            <div class="menuitem">
                <a href="bookkeeperProgrammer.html">Programmer's guide</a>
            </div>
        </div>
        <div onclick="SwitchMenu('menu_4', 'skin/')" id="menu_4Title" class="menutitle">Admin &amp; Ops</div>
        <div id="menu_4" class="menuitemgroup">
            <div class="menuitem">
                <a href="zookeeperAdmin.html">Administrator's Guide</a>
            </div>
            <div class="menuitem">
                <a href="zookeeperQuotas.html">Quota Guide</a>
            </div>
            <div class="menuitem">
                <a href="zookeeperJMX.html">JMX</a>
            </div>
            <div class="menuitem">
                <a href="zookeeperObservers.html">Observers Guide</a>
            </div>
        </div>
        <div onclick="SwitchMenu('menu_5', 'skin/')" id="menu_5Title" class="menutitle">Contributor</div>
        <div id="menu_5" class="menuitemgroup">
            <div class="menuitem">
                <a href="zookeeperInternals.html">ZooKeeper Internals</a>
            </div>
        </div>
        <div onclick="SwitchMenu('menu_6', 'skin/')" id="menu_6Title" class="menutitle">Miscellaneous</div>
        <div id="menu_6" class="menuitemgroup">
            <div class="menuitem">
                <a href="https://cwiki.apache.org/confluence/display/ZOOKEEPER">Wiki</a>
            </div>
            <div class="menuitem">
                <a href="https://cwiki.apache.org/confluence/display/ZOOKEEPER/FAQ">FAQ</a>
            </div>
            <div class="menuitem">
                <a href="http://zookeeper.apache.org/mailing_lists.html">Mailing Lists</a>
            </div>
        </div>
    </div>
    <div id="content">
<!--
Copyright 2002-2004 The Apache Software Foundation

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
//--><h1>Streaming with BookKeeper</h1>
<ul>
  <li><a href="#bk_StreamSummary">Summary</a></li>
  <li><a href="#bk_LedgerOutputStream">Writing a stream of bytes</a></li>
  <li><a href="#bk_LedgerInputStream">Reading a stream of bytes</a></li>
</ul><p><a name="bk_StreamSummary"></a></p><h2>Summary</h2><p>When using the BookKeeper API, an application has to split the data to write into entries, each entry being a byte array. This is natural for many applications. For example, when using BookKeeper for write-ahead logging, an application typically wants to write the modifications corresponding to a command or a transaction. Some other applications, however, might not have a natural boundary for entries, and may prefer to write and read streams of bytes. This is exactly the purpose of the stream API we have implemented on top of BookKeeper.</p><p>The stream API is implemented in the package <code>Streaming</code>, and it contains two main classes: <code>LedgerOutputStream</code> and <code>LedgerInputStream</code>. The class names are indicative of what they do.</p><p><a name="bk_LedgerOutputStream"></a></p><h2>Writing a stream of bytes</h2><p>Class <code>LedgerOutputStream</code> implements two constructors and five public methods:</p>
<pre><code>public LedgerOutputStream(LedgerHandle lh) 
</code></pre><p>where: <code>lh</code> is a ledger handle for a previously created and open ledger. </p>
<pre><code>public LedgerOutputStream(LedgerHandle lh, int size) 
</code></pre><p>where:</p>
<ul>
  <li><code>lh</code> is a ledger handle for a previously created and open ledger.</li>
  <li><code>size</code> is the size of the byte buffer to store written bytes before flushing.</li>
</ul><p><strong>Closing a stream.</strong> This call closes the stream by flushing the write buffer.</p>
<pre><code>public void close() 
</code></pre><p>which has no parameters.</p><p><strong>Flushing a stream.</strong> This call essentially flushes the write buffer.</p>
<pre><code>public synchronized void flush() 
</code></pre><p>which has no parameters.</p><p><strong>Writing bytes.</strong> There are three calls for writing bytes to a stream.</p>
<pre><code>public synchronized void write(byte[] b) 
</code></pre><p>where:</p>
<ul>
  <li><code>b</code> is an array of bytes to write.</li>
</ul>
<pre><code>public synchronized void write(byte[] b, int off, int len) 
</code></pre><p>where:</p>
<ul>
  <li><code>b</code> is an array of bytes to write.</li>
  <li><code>off</code> is a buffer offset.</li>
  <li><code>len</code> is the length to write.</li>
</ul>
<pre><code>public synchronized void write(int b) 
</code></pre><p>where:</p>
<ul>
  <li><code>b</code> contains a byte to write. The method writes the least significant byte of the integer four bytes.</li>
</ul><p><a name="bk_LedgerInputStream"></a></p><h2>Reading a stream of bytes</h2><p>Class <code>LedgerOutputStream</code> implements two constructors and four public methods:</p>
<pre><code>public LedgerInputStream(LedgerHandle lh)
throws BKException, InterruptedException 
</code></pre><p>where:</p>
<ul>
  <li><code>lh</code> is a ledger handle for a previously created and open ledger.</li>
</ul>
<pre><code>public LedgerInputStream(LedgerHandle lh, int size) 
throws BKException, InterruptedException
</code></pre><p>where:</p>
<ul>
  <li><code>lh</code> is a ledger handle for a previously created and open ledger.</li>
  <li><code>size</code> is the size of the byte buffer to store bytes that the application will eventually read.</li>
</ul><p><strong>Closing.</strong> There is one call to close an input stream, but the call is currently empty and the application is responsible for closing the ledger handle. </p>
<pre><code>public void close()
</code></pre><p>which has no parameters.</p><p><strong>Reading.</strong> There are three calls to read from the stream.</p>
<pre><code>public synchronized int read()
throws IOException 
</code></pre><p>which has no parameters.</p>
<pre><code>public synchronized int read(byte[] b)
throws IOException 
</code></pre><p>where:</p>
<ul>
  <li><code>b</code> is a byte array to write to.</li>
</ul>
<pre><code>public synchronized int read(byte[] b, int off, int len)
throws IOException 
</code></pre><p>where:</p>
<ul>
  <li><code>b</code> is a byte array to write to.</li>
  <li><code>off</code> is an offset for byte array <code>b</code>.</li>
  <li><code>len</code> is the length in bytes to write to <code>b</code>.</li>
</ul></div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
    <div class="lastmodified">
        <script type="text/javascript">
        <!--
            document.write("Last Published: " + document.lastModified);
        //  -->
        </script>
    </div>
    <div class="copyright">
        Copyright &copy; <a href="http://www.apache.org/licenses/">The Apache Software Foundation.</a>
    </div>
    <div id="logos"></div>
</div>
</body>
</html>